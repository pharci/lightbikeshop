{% extends "core/base.html" %}
{% load static %}

{% block title %}–ó–∞–∫–∞–∑ ‚Ññ{{ order.order_id }}{% endblock %}

{% block styles %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'cart/css/style.css' %}">
{% endblock %}

{% block content %}
<div class="container checkout-grid" 
     id="OrderPage"
     data-order-id="{{ order.order_id }}"
     style="margin-top:16px">

  <div>
    <div class="confirm">
      <div class="confirm__card">
        {% comment %} –ò–∫–æ–Ω–∫–∞/—Ü–≤–µ—Ç –ø–æ —Å—Ç–∞—Ç—É—Å—É {% endcomment %}
        {% with st=order.status %}
          {% if st == "created" %}
            <div class="confirm__icon" style="background:#fff3e6;color:#ad5c00">‚åõ</div>
          {% elif st == "paid" %}
            <div class="confirm__icon" style="background:#e8f6ee;color:#1a7f49">‚úî</div>
          {% elif st == "assembled" %}
            <div class="confirm__icon" style="background:#e8f0fe;color:#1a3ea1">üß©</div>
          {% elif st == "shipped" %}
            <div class="confirm__icon" style="background:#e7f3ff;color:#0b5ed7">üöö</div>
          {% elif st == "delivered" %}
            <div class="confirm__icon" style="background:#e8f6ee;color:#1a7f49">üì¶</div>
          {% else %}
            <div class="confirm__icon" style="background:#f8f9fa;color:#6c757d">‚Ñπ</div>
          {% endif %}
        {% endwith %}

        <h1 class="section__title" style="margin-bottom:6px">–ó–∞–∫–∞–∑ {{ order.order_id }}</h1>

        <div class="confirm__order">
          –æ—Ç {{ order.date_ordered|date:"d.m.Y H:i" }}
          &nbsp;‚Ä¢&nbsp; —Å—Ç–∞—Ç—É—Å: <strong>{{ order.get_status_display|default:order.status }}</strong>
        </div>

        {% if order.status == "created" %}
          <p class="confirm__text">–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã. –ù–∞–∂–º–∏—Ç–µ ¬´–û–ø–ª–∞—Ç–∏—Ç—å –æ–Ω–ª–∞–π–Ω¬ª, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.</p>
        {% elif order.status == "paid" %}
          <p class="confirm__text">–û–ø–ª–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∞. –ó–∞–∫–∞–∑ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è.</p>
        {% elif order.status == "assembled" %}
          <p class="confirm__text">–ó–∞–∫–∞–∑ —Å–æ–±—Ä–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ/–≤—ã–¥–∞—á–µ.</p>
        {% elif order.status == "shipped" %}
          <p class="confirm__text">–ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω. –û–∂–∏–¥–∞–π—Ç–µ –¥–æ—Å—Ç–∞–≤–∫—É.</p>
        {% elif order.status == "delivered" %}
          <p class="confirm__text">–ó–∞–∫–∞–∑ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω. –°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–∫—É–ø–∫—É.</p>
        {% else %}
          <p class="confirm__text">–°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª–∏—Ç—Å—è –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏.</p>
        {% endif %}

        {% if order.promo_code %}
          <div class="promo__chip" style="margin-top:8px">
            –ü—Ä–æ–º–æ–∫–æ–¥: <strong>{{ order.promo_code.code }}</strong>
            {% if order.promo_discount_amount %} ‚Äî —Å–∫–∏–¥–∫–∞ {{ order.promo_discount_amount|floatformat:2 }} ‚ÇΩ{% endif %}
          </div>
        {% endif %}

        <p class="confirm__hint">
          –°—Å—ã–ª–∫–∞ –Ω–∞ –∑–∞–∫–∞–∑:<br>
          <a href="{{ request.build_absolute_uri }}">{{ request.build_absolute_uri }}</a>
        </p>
      </div>
    </div>

    <div class="island" style="margin-top:20px">
      <h3 class="island__title">–°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞</h3>
      {% if order.items.all %}
        <div class="cart-items">
          {% for it in order.items.all %}
            <div class="cart-item">
              <div class="cart-item__image">
                {% with img=it.variant.images.first %}
                  {% if img and img.image %}<img src="{{ img.image.url }}" alt="">{% else %}
                    <img src="{% static 'img/placeholder.png' %}" alt="">{% endif %}
                {% endwith %}
              </div>
              <div>
                <a class="cart-item__title-link" href="{{ it.variant.get_absolute_url }}">
                  <div class="cart-item__title">{{ it.variant.display_name }}</div>
                </a>
                <div class="cart-item__meta">
                  <span class="meta-chip">–ö–æ–ª-–≤–æ: {{ it.quantity }}</span>
                </div>
              </div>
              <div class="cart-item__controls">
                <div class="cart-item__price">{{ it.price|floatformat:2 }} ‚ÇΩ</div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="cart-empty">
          <div class="cart-empty__title">–í –∑–∞–∫–∞–∑–µ –Ω–µ—Ç –ø–æ–∑–∏—Ü–∏–π</div>
          <div class="cart-empty__text">–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞.</div>
        </div>
      {% endif %}
    </div>
  </div>

  <aside class="order-summary">
    {% with subtotal=order.get_subtotal_price total=order.get_total_price discount=order.promo_discount_amount %}
      <div class="order-summary__row">
        <div>–ü–æ–¥—ã—Ç–æ–≥</div><div>{{ subtotal|floatformat:2 }} ‚ÇΩ</div>
      </div>
      <div class="order-summary__row">
        <div>–°–∫–∏–¥–∫–∞</div><div>-{{ discount|default:0|floatformat:2 }} ‚ÇΩ</div>
      </div>
      <hr class="order-summary__hr">
      <div class="order-summary__total">
        <div>–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ</div><div>{{ total|floatformat:2 }} ‚ÇΩ</div>
      </div>

      {% if order.status == "created" %}
        <a href="{% url 'cart:order_pay' order.order_id %}" class="btn btn--primary order-summary__btn">–û–ø–ª–∞—Ç–∏—Ç—å –æ–Ω–ª–∞–π–Ω</a>
        <p class="summary__fineprint">–û–ø–ª–∞—Ç–∞ –ø—Ä–æ–π–¥—ë—Ç –Ω–∞ –∑–∞—â–∏—â—ë–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ T-Bank.</p>
      {% elif order.status == "paid" %}
        <p class="summary__fineprint">–û–ø–ª–∞—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞.</p>
      {% endif %}
    {% endwith %}
  </aside>

</div>
{% endblock %}


{% block scripts %}
  {{ block.super }}
  <script src="{% static 'cart/js/order_poll.js' %}"></script>
{% endblock %}