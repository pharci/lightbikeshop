{% extends "core/base.html" %}{% load static %}
{% block title %}–ó–∞–∫–∞–∑ ‚Ññ{{ order.order_id }}{% endblock %}
{% block styles %}{{ block.super }}<link rel="stylesheet" href="{% static 'cart/css/style.css' %}">{% endblock %}
{% block content %}
<div class="container" id="OrderPage" data-order-id="{{ order.order_id }}">
  <div class="page-grid">
    <div class="detail-grid">
      <div class="confirm__card">
        {% with st=order.status %}
          <div class="confirm__icon confirm__icon--{{ st|default:'created' }}">
            {% if st == "created" %}‚åõ{% elif st == "paid" %}‚úî{% elif st == "assembled" %}üß©{% elif st == "shipped" %}üöö{% elif st == "delivered" %}üì¶{% else %}‚Ñπ{% endif %}
          </div>
        {% endwith %}
        <h1 class="section__title">–ó–∞–∫–∞–∑ {{ order.order_id }}</h1>
        <div class="confirm__order">–æ—Ç {{ order.date_ordered|date:"d.m.Y H:i" }} ‚Ä¢ —Å—Ç–∞—Ç—É—Å: <span class="status-badge status-badge--{{ order.status }}">{{ order.get_status_display|default:order.status }}</span></div>
        <div class="confirm__actions">
          <a href="https://t.me/light_bikeshop" class="btn">–ü–æ–º–æ—â—å</a>
        </div>
      </div>

      <section class="island">
        <ol class="steps">
          <li class="steps__item {% if order.status == 'created' %}is-active{% elif order.status in 'paid assembled shipped delivered' %}is-done{% endif %}"><span class="steps__dot"></span><span class="steps__label">–ù–æ–≤—ã–π</span></li>
          <li class="steps__item {% if order.status == 'paid' %}is-active{% elif order.status in 'assembled shipped delivered' %}is-done{% endif %}"><span class="steps__dot"></span><span class="steps__label">–û–ø–ª–∞—á–µ–Ω</span></li>
          <li class="steps__item {% if order.status == 'assembled' %}is-active{% elif order.status in 'shipped delivered' %}is-done{% endif %}"><span class="steps__dot"></span><span class="steps__label">–°–æ–±—Ä–∞–Ω</span></li>
          <li class="steps__item {% if order.status == 'shipped' %}is-active{% elif order.status == 'delivered' %}is-done{% endif %}"><span class="steps__dot"></span><span class="steps__label">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω</span></li>
          <li class="steps__item {% if order.status == 'delivered' %}is-active{% endif %}"><span class="steps__dot"></span><span class="steps__label">–î–æ—Å—Ç–∞–≤–ª–µ–Ω</span></li>
        </ol>
      </section>

      <section class="island">
        <h3 class="island__title">–î–æ—Å—Ç–∞–≤–∫–∞</h3>
        <div class="order-summary__row"><span class="muted">–ì–æ—Ä–æ–¥:</span><span>{{ order.city }}</span></div>
        {% if order.pvz_code %}
          <div class="order-summary__row"><span class="muted">–¢–∏–ø:</span><span>–ü–í–ó ({{ order.pvz_provider }})</span></div>
          <div class="order-summary__row"><span class="muted">–ö–æ–¥ –ü–í–ó:</span><span>{{ order.pvz_code }}</span></div>
          {% if order.pvz_address %}<div class="order-summary__row"><span class="muted">–ê–¥—Ä–µ—Å:</span><span>{{ order.pvz_address }}</span></div>{% endif %}
        {% else %}
          <div class="order-summary__row"><span class="muted">–¢–∏–ø:</span><span>–°–∞–º–æ–≤—ã–≤–æ–∑</span></div>
        {% endif %}
        {% if order.invoice %}
          <div class="order-summary__row">
            <span class="muted">–¢—Ä–µ–∫-–Ω–æ–º–µ—Ä:</span>
            <div>
              <span class="track-box" id="trackNum">{{ order.invoice }}</span>
              <button class="track-copy" onclick="copyTrack()">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
          </div>
          <div id="toast" class="toast">–¢—Ä–µ–∫-–Ω–æ–º–µ—Ä —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω</div>
        {% endif %}
      </section>

      <section class="island">
        <h3 class="island__title">–ü–æ–∫—É–ø–∞—Ç–µ–ª—å</h3>
        <div class="order-summary__row"><span class="muted">–§–ò–û:</span><span>{{ order.user_name }}</span></div>
        <div class="order-summary__row"><span class="muted">–¢–µ–ª–µ—Ñ–æ–Ω:</span><span>{{ order.contact_phone }}</span></div>
        {% if order.email %}<div class="order-summary__row"><span class="muted">–ü–æ—á—Ç–∞:</span><span>{{ order.email }}</span></div>{% endif %}
      </section>

      
      {% if order.promo_code %}
      <section class="island">
        <h3 class="island__title">–ü—Ä–æ–º–æ–∫–æ–¥</h3>
        <div class="order-summary__row"><span class="muted">–ö–æ–¥:</span><span>{{ order.promo_code.code }}</span></div>
      </section>
      {% endif %}

      <section class="island">
        <h3 class="island__title">–°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞</h3>
        {% if order.items.all %}
          <div class="cart-items">
            {% for it in order.items.all %}
              <article class="cart-item">
                <a class="cart-item__image" href="{{ it.variant.get_absolute_url }}">
                  {% with img=it.variant.images.first %}{% if img and img.image %}<img src="{{ img.image.url }}" alt="">{% else %}<img src="{% static 'img/placeholder.png' %}" alt="">{% endif %}{% endwith %}
                </a>
                <div>
                  <a class="cart-item__title-link" href="{{ it.variant.get_absolute_url }}"><h3 class="cart-item__title">{{ it.variant.display_name }}</h3></a>
                  <div class="cart-item__meta"><span class="meta-chip">–ö–æ–ª-–≤–æ: {{ it.quantity }}</span></div>
                </div>
                <div class="cart-item__controls"><div class="cart-item__price">{{ it.price|floatformat:2 }} ‚ÇΩ</div></div>
              </article>
            {% endfor %}
          </div>
        {% else %}
          <div class="cart-empty"><div class="cart-empty__title">–í –∑–∞–∫–∞–∑–µ –Ω–µ—Ç –ø–æ–∑–∏—Ü–∏–π</div><div class="cart-empty__text">–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞.</div></div>
        {% endif %}
      </section>
    </div>

    <aside class="order-summary">
      <div class="order-summary__row">
        <div>{{ order.get_total_count }} —Ç–æ–≤–∞—Ä–æ–≤</div>
        <div class="filler-underline"></div>
        <div>{{ order.subtotal|floatformat:2 }} ‚ÇΩ</div>
      </div>

      <div class="order-summary__row">
        <div>–°–∫–∏–¥–∫–∞</div>
        <div class="filler-underline"></div>
        <div>-{{ order.discount_total|floatformat:2 }} ‚ÇΩ</div>
      </div>

      <div class="order-summary__row">
        <div>–î–æ—Å—Ç–∞–≤–∫–∞</div>
        <div class="filler-underline"></div>
        <div>{{ order.shipping_total|floatformat:2 }} ‚ÇΩ</div>
      </div>

      <hr class="order-summary__hr">

      <div class="order-summary__total">
        <div>–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ</div>
        <div class="filler-underline"></div>
        <div>{{ order.total|floatformat:2 }} ‚ÇΩ</div>
      </div>

      {% if order.status == "created" %}
        <a href="{{ order.payment_url }}" class="btn btn--primary order-summary__btn">
          –û–ø–ª–∞—Ç–∏—Ç—å –æ–Ω–ª–∞–π–Ω
        </a>
        <p class="summary__fineprint">–û–ø–ª–∞—Ç–∞ –ø—Ä–æ–π–¥—ë—Ç –Ω–∞ –∑–∞—â–∏—â—ë–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ T-Bank.</p>
      {% elif order.status == "paid" %}
        <p class="summary__fineprint">–û–ø–ª–∞—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞.</p>
      {% endif %}
    </aside>
  </div>
</div>
{% endblock %}
{% block scripts %}{{ block.super }}<script src="{% static 'cart/js/order_poll.js' %}"></script>{% endblock %}
