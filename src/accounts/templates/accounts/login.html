{% extends "core/base.html" %}
{% load static %}

{% block title %}Вход{% endblock %}

{% block styles %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'accounts/css/login.css' %}">
{% endblock %}

{% block content %}
<div class="container auth">
  <div class="section__header u-center"><h1 class="section__title">Войти или зарегистрироваться</h1></div>

  <div class="auth__grid">
    <section class="card auth-card">
      <form id="email-step" class="form" novalidate>
        {% csrf_token %}
        <div class="field">
          <label for="id_email" class="label">Почта</label>
          <input id="id_email" type="email" class="input" placeholder="you@example.com" autocomplete="email" required />
          <p id="email-error" class="error" hidden>Введите корректный e-mail.</p>
        </div>
        <div class="actions">
          <button type="submit" class="btn" id="send-btn">Войти</button>
        </div>
        <input type="hidden" id="g-recaptcha-response" name="g-recaptcha-response">
      </form>

      <form id="code-step" class="form" novalidate hidden>
        {% csrf_token %}
        <input type="hidden" id="request_id">
        <input type="hidden" id="email_hidden">
        <div class="field">
          <label for="id_code" class="label">Код из письма</label>
          <div class="code-row">
            <input id="id_code" type="text" class="input code-input" inputmode="numeric" maxlength="6" placeholder="XXXXXX" required />
            <button type="submit" class="btn" id="verify-btn">Подтвердить</button>
          </div>
          <p id="code-error" class="error" hidden>Неверный код.</p>
          <p id="code-info" class="hint" hidden></p>
        </div>
        <div class="inline inline--gap-sm">
          <button type="button" id="resend-btn" class="btn-link" disabled>Отправить ещё <span id="resend-timer"></span></button>
          <button type="button" id="change-email-btn" class="btn-link">Изменить почту</button>
        </div>
      </form>

      <div class="mt-2">
        <script async src="https://telegram.org/js/telegram-widget.js?22"
          data-telegram-login="lightbikebot"
          data-size="large"
          data-userpic="false"
          data-request-access="write"
          data-auth-url="https://pharci.ru/tg/auth/"></script>
      </div>

      <p class="legal">
        This site is protected by reCAPTCHA and the Google
        <a class="link" href="https://policies.google.com/privacy" target="_blank" rel="noopener">Privacy Policy</a> and
        <a class="link" href="https://policies.google.com/terms" target="_blank" rel="noopener">Terms of Service</a> apply.
      </p>
    </section>
  </div>
</div>
{% endblock %}

{% block scripts %}
  {{ block.super }}
  <script src="https://www.google.com/recaptcha/api.js?render={{ RECAPTCHA_SITE_KEY }}"></script>
  <script>window.recaptchaSiteKey="{{ RECAPTCHA_SITE_KEY }}";</script>
  <script src="{% static 'accounts/js/login.js' %}"></script>
{% endblock %}
