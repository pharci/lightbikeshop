<!DOCTYPE html>
{% load static %}
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>{% block title %}Light - Магазин лёгких запчастей{% endblock %}</title>
  <meta name="description" content="{% block meta_description %}{% endblock %}">
  <link rel="canonical" href="{% block canonical %}{{ request.scheme }}://{{ request.get_host }}{{ request.path }}{% endblock %}">

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- reset.css -->
  <link rel="stylesheet" href="{% static 'core/css/reset.css' %}">

  {# Гугл-шрифт #}
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;700&display=swap" rel="stylesheet">

  {# Иконка #}
  <link rel="shortcut icon" href="{% static 'core/icons/logoweb.png' %}" type="image/png">
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>

  {# Swiper CSS #}
  <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">

  {# jquery #}
  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

  {# lightbox2#}
  <link href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/css/lightbox.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/js/lightbox.min.js"></script>
  <script>
    lightbox.option({
      fadeDuration: 120,    // было 250…400
      imageFadeDuration: 120,
      resizeDuration: 120,
    });
  </script>

  {# Базовые стили сайта #}
  <link rel="stylesheet" href="{% static 'core/css/main.css' %}">

  {# Переиспользуемые компоненты (пример: тайтл секции) #}
  {% block styles %}
  {% endblock %}

  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@cdek-it/widget@3" charset="utf-8"></script>

  <script type="text/javascript">   
      var digiScript = document.createElement('script');   
      digiScript.src = '//aq.dolyame.ru/11112/client.js';  
      digiScript.defer = true;   
      digiScript.async = true;   
      document.head.appendChild(digiScript);   
  </script>   

  {% if request.COOKIES.cookie_consent == 'all' %}
  <noscript>
    <div><img src="https://mc.yandex.ru/watch/94255695" style="position:absolute;left:-9999px;" alt=""></div>
  </noscript>
  {% endif %}
</head>

<body>
  <script type="text/javascript">
      var digiScript = document.createElement ('script');
      digiScript.src = '//aq.dolyame.ru/site id/client.js?ts=' + Date.now();
      digiScript.defer = true;
      digiScript.async = true;
      document.body.appendChild (digiScript);
  </script>

  <div class="layout">

    <!-- Header -->
    <header class="header">
      <div class="header__bar">
        <div class="header__inner">

          <div class="header__logo">
            <a class="logo" href="{% url 'core:home' %}">LightShop</a>
          </div>

          <div class="header__search">
            <form method="GET" action="{% url 'products:search' %}" id="search-form" class="search">
              <input 
                name="q" 
                type="text" 
                class="search__input" 
                placeholder="Поиск товаров..." 
                autocomplete="off"
                value="{{ request.GET.q|default:'' }}"
              />
              <button type="submit" class="search__btn" id="search-button" aria-label="Искать">
                <i data-lucide="search"></i>
              </button>
            </form>
          </div>

          <nav class="header__menu">
            <a href="{% url 'core:faq' %}" class="menuitem" title="FAQ">
              <i data-lucide="help-circle"></i>
              <span>FAQ</span>
            </a>

            <a href="{% url 'cart:cart' %}" class="menuitem" title="Корзина">
              <span class="menuitem__icon">
                <i data-lucide="shopping-cart"></i>
                <span class="cart-count"><span class="cart-count-text">{{ cartItems }}</span></span>
              </span>
              <span>Корзина</span>
            </a>

            {% if user.is_authenticated %}
            <a href="{% url 'accounts:profile' %}" class="menuitem" title="Профиль">
              <i data-lucide="user"></i>
              <span>Профиль</span>
            </a>
            {% else %}
            <a href="{% url 'accounts:login' %}" class="menuitem" title="Войти">
              <i data-lucide="user"></i>
              <span>Войти</span>
            </a>
            {% endif %}
          </nav>
        </div>
      </div>

      <div class="header__nav">
        <a class="navlink" href="{% url 'products:catalog' %}">Каталог</a>
      </div>
    </header>
    
    <!-- Content -->
    <main class="page-wrapper">
      {% include "core/partials/breadcrumbs.html" %}
      {% block content %}{% endblock content %}
    </main>

    <!-- Footer desktop -->
    <!-- МЕГА‑МОБИЛЬНЫЙ ФУТЕР С КРАСИВЫМИ ССЫЛКАМИ -->
    <footer class="footer">
      <!-- Desktop grid (как было) -->
      <div class="footer__grid">
        <div class="footer__col">
          <p class="footer__title">Соцсети</p>
          {% for p in footer_cols.1 %}
            <a class="footer__link" href="{{ p.get_absolute_url }}">{{ p.title }}</a>
          {% empty %}<p class="footer__text">—</p>{% endfor %}
        </div>

        <div class="footer__col">
          <p class="footer__title">Контакты</p>
          {% for p in footer_cols.2 %}
            {% if p.external_url %}
              <a class="footer__link" href="{{ p.get_absolute_url }}" rel="noopener" target="_blank">{{ p.title }}</a>
            {% else %}
              <a class="footer__link" href="{{ p.get_absolute_url }}">{{ p.title }}</a>
            {% endif %}
          {% empty %}<p class="footer__text">—</p>{% endfor %}
        </div>

        <div class="footer__col">
          <p class="footer__title">Информация</p>
          {% for p in footer_cols.3 %}
            <a class="footer__link" href="{{ p.get_absolute_url }}">{{ p.title }}</a>
          {% empty %}<p class="footer__text">—</p>{% endfor %}
        </div>

        <div class="footer__col">
          <p class="footer__title">Помощь</p>
          {% for p in footer_cols.4 %}
            <a class="footer__link" href="{{ p.get_absolute_url }}">{{ p.title }}</a>
          {% empty %}<p class="footer__text">—</p>{% endfor %}
        </div>

        <div class="footer__bottom">
          <p class="footer__copy">© 2025 <a href="/" class="footer__brand">Lightbikeshop.ru</a> — магазин запчастей для BMX</p>
        </div>
      </div>

      <!-- Mobile: аккуратные аккордеоны и чип‑ссылки -->
      <div class="footer__mobile" role="navigation" aria-label="Футер">
        <details class="f-acc" open>
          <summary class="f-acc__summary"><span>Соцсети</span><i data-lucide="chevron-down" aria-hidden="true"></i></summary>
          <nav class="f-acc__list">
            {% for p in footer_cols.1 %}
              <a class="f-link" href="{{ p.get_absolute_url }}">
                <i class="f-link__icon" data-lucide="share-2" aria-hidden="true"></i>
                <span class="f-link__text">{{ p.title }}</span>
                <i class="f-link__arrow" data-lucide="arrow-up-right" aria-hidden="true"></i>
              </a>
            {% empty %}
              <span class="f-empty">Нет ссылок</span>
            {% endfor %}
          </nav>
        </details>

        <details class="f-acc">
          <summary class="f-acc__summary"><span>Контакты</span><i data-lucide="chevron-down" aria-hidden="true"></i></summary>
          <nav class="f-acc__list">
            {% for p in footer_cols.2 %}
              {% if p.external_url %}
                <a class="f-link" href="{{ p.get_absolute_url }}" rel="noopener" target="_blank">
                  <span class="f-link__text">{{ p.title }}</span>
                  <i class="f-link__arrow" data-lucide="external-link" aria-hidden="true"></i>
                </a>
              {% else %}
                <a class="f-link" href="{{ p.get_absolute_url }}">
                  <span class="f-link__text">{{ p.title }}</span>
                  <i class="f-link__arrow" data-lucide="arrow-right" aria-hidden="true"></i>
                </a>
              {% endif %}
            {% empty %}
              <span class="f-empty">Нет ссылок</span>
            {% endfor %}
          </nav>
        </details>

        <details class="f-acc">
          <summary class="f-acc__summary"><span>Информация</span><i data-lucide="chevron-down" aria-hidden="true"></i></summary>
          <nav class="f-acc__list">
            {% for p in footer_cols.3 %}
              <a class="f-link" href="{{ p.get_absolute_url }}">
                <i class="f-link__icon" data-lucide="file-text" aria-hidden="true"></i>
                <span class="f-link__text">{{ p.title }}</span>
                <i class="f-link__arrow" data-lucide="arrow-right" aria-hidden="true"></i>
              </a>
            {% empty %}
              <span class="f-empty">Нет ссылок</span>
            {% endfor %}
          </nav>
        </details>

        <details class="f-acc">
          <summary class="f-acc__summary"><span>Помощь</span><i data-lucide="chevron-down" aria-hidden="true"></i></summary>
          <nav class="f-acc__list">
            {% for p in footer_cols.4 %}
              <a class="f-link" href="{{ p.get_absolute_url }}">
                <i class="f-link__icon" data-lucide="life-buoy" aria-hidden="true"></i>
                <span class="f-link__text">{{ p.title }}</span>
                <i class="f-link__arrow" data-lucide="arrow-right" aria-hidden="true"></i>
              </a>
            {% empty %}
              <span class="f-empty">Нет ссылок</span>
            {% endfor %}
          </nav>
        </details>

        <div class="f-copy">
          <p class="footer__copy">© 2025 <a href="/" class="footer__brand">Lightbikeshop.ru</a></p>
        </div>
      </div>

      <!-- Mobile bottom bar (обновлённый) -->
      <div class="footerbar" role="navigation" aria-label="Нижнее меню">
        <a href="{% url 'core:home' %}" class="footerbar__btn" aria-label="Главная">
          <i data-lucide="home"></i><span>Главная</span>
        </a>
        <a href="{% url 'products:catalog' %}" class="footerbar__btn" aria-label="Каталог">
          <i data-lucide="grid"></i><span>Каталог</span>
        </a>
        <a href="{% url 'cart:cart' %}" class="footerbar__btn" aria-label="Корзина">
          <span class="footerbar__icon">
            <i data-lucide="shopping-cart"></i>
            <span class="cart-count"><span class="cart-count-text">{{ cartItems }}</span></span>
          </span>
          <span>Корзина</span>
        </a>
        <a href="{% url 'core:faq' %}" class="footerbar__btn" aria-label="FAQ">
          <i data-lucide="help-circle"></i><span>FAQ</span>
        </a>
        {% if user.is_authenticated %}
        <a href="{% url 'accounts:profile' %}" class="footerbar__btn" aria-label="Профиль">
          <i data-lucide="user"></i><span>Профиль</span>
        </a>
        {% else %}
        <a href="{% url 'accounts:login' %}" class="footerbar__btn" aria-label="Войти">
          <i data-lucide="user"></i><span>Войти</span>
        </a>
        {% endif %}
      </div>
    </footer>

  </div> {# /layout #}

  {# Swiper JS #}
  <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>

  {# Общие скрипты #}
  <script src="{% static 'core/js/main.js' %}"></script>

  <script>lucide.createIcons();</script>

  {% block scripts %}{% endblock %}

  <div id="cookie-banner" class="cc" style="display:none;">
    <div class="cc__text">
      Мы используем cookies. Нажмите «Принять всё» для аналитики.
      <a class="cc__link" href="/legal/cookies/" target="_blank" rel="noopener">Подробнее</a>
    </div>
    <div class="cc__actions">
      <button id="cc-necessary" type="button" class="cc__btn cc__btn--ghost">Только необходимые</button>
      <button id="cc-accept" type="button" class="cc__btn cc__btn--primary">Принять всё</button>
    </div>
  </div>
</body>
</html>